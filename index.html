<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Universal Turbo Racer</title>
    <style>
        :root {
            --road-width: 350px;
            --neon-blue: #00f2ff;
            --neon-pink: #ff0055;
        }

        body {
            background: #0a0a0f;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Segoe UI', sans-serif;
            color: white;
            overflow: hidden;
            touch-action: none;
        }

        /* Responsive Container */
        .game-wrapper {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dashboard {
            width: 90%;
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--neon-blue);
            border-radius: 15px;
            margin-bottom: 10px;
            font-size: clamp(14px, 4vw, 18px); /* Fluid typography */
        }

        .road {
            position: relative;
            width: 90vw; 
            max-width: 380px; 
            height: 65vh; 
            background: #1a1a1a;
            border-left: 4px solid #333;
            border-right: 4px solid #333;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .line {
            width: 2%;
            height: 50px;
            background: rgba(255,255,255,0.2);
            position: absolute;
            left: 49%;
        }

        .car {
            position: absolute;
            width: 45px;
            height: 75px;
            border-radius: 8px;
            z-index: 10;
        }

        .player {
            background: var(--neon-pink);
            box-shadow: 0 0 20px var(--neon-pink);
            border: 2px solid white;
        }

        /* Controller Styling */
        .controls {
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .mobile-joystick {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .joy-btn {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.1);
            border: 2px solid var(--neon-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            user-select: none;
        }

        button {
            background: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        button:active { background: var(--neon-blue); color: black; }

        /* Hide mobile buttons on desktop if needed, but keeping for accessibility */
        @media (min-width: 1024px) {
            .mobile-joystick { margin-bottom: 20px; }
        }
    </style>
</head>
<body>

    <div class="game-wrapper">
        <div class="dashboard">
            <div>üèÜ <span id="highScore">0</span></div>
            <div>üî• <span id="score">0</span></div>
            <div>üèÅ <span id="rank">6</span>/6</div>
        </div>

        <div class="road" id="road"></div>

        <div class="mobile-joystick">
            <div class="joy-btn" id="leftBtn">‚óÄ</div>
            <div class="joy-btn" id="turboBtn">üöÄ</div>
            <div class="joy-btn" id="rightBtn">‚ñ∂</div>
        </div>

        <div class="controls">
            <button id="startBtn">Start</button>
            <button id="pauseBtn" disabled>Pause</button>
        </div>
    </div>

    <script>
        const road = document.getElementById('road');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('highScore');
        const rankDisplay = document.getElementById('rank');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');

        let gameRunning = false;
        let score = 0;
        let highScore = localStorage.getItem('universalRacerScore') || 0;
        highScoreDisplay.innerText = highScore;

        let roadBox = road.getBoundingClientRect();
        let player = { x: 0, y: 0, speed: 7, turbo: false };
        let enemyCars = [];
        let roadLines = [];
        let animationId;

        const playerCar = document.createElement('div');
        playerCar.classList.add('car', 'player');
        road.appendChild(playerCar);

        function initPositions() {
            roadBox = road.getBoundingClientRect();
            player.x = (roadBox.width / 2) - 22;
            player.y = roadBox.height - 100;
            playerCar.style.left = player.x + "px";
            playerCar.style.top = player.y + "px";
        }

        function setupRoad() {
            roadLines.forEach(l => l.remove());
            roadLines = [];
            for (let i = 0; i < 6; i++) {
                let line = document.createElement('div');
                line.classList.add('line');
                line.y = i * 120;
                line.style.top = line.y + "px";
                road.appendChild(line);
                roadLines.push(line);
            }
        }

        function createEnemies() {
            enemyCars.forEach(e => e.element.remove());
            enemyCars = [];
            const colors = ['#00d2ff', '#ffce00', '#00ff44', '#bc00ff', '#ffffff'];
            for (let i = 0; i < 5; i++) {
                let div = document.createElement('div');
                div.classList.add('car', 'enemy');
                div.style.backgroundColor = colors[i];
                let enemy = {
                    element: div,
                    x: Math.random() * (roadBox.width - 50),
                    y: (i * 200) * -1,
                    speed: 3 + Math.random() * 3
                };
                road.appendChild(div);
                enemyCars.push(enemy);
            }
        }

        function update() {
            if (!gameRunning) return;

            // Move lines
            roadLines.forEach(line => {
                line.y += (player.turbo ? 15 : 6);
                if (line.y >= roadBox.height) line.y = -100;
                line.style.top = line.y + "px";
            });

            let passed = 0;
            enemyCars.forEach(enemy => {
                enemy.y += (player.turbo ? enemy.speed + 6 : enemy.speed);
                if (enemy.y > roadBox.height) {
                    enemy.y = -200;
                    enemy.x = Math.random() * (roadBox.width - 50);
                    score += 10;
                    scoreDisplay.innerText = score;
                    if (score > highScore) {
                        highScore = score;
                        highScoreDisplay.innerText = highScore;
                        localStorage.setItem('universalRacerScore', highScore);
                    }
                }
                enemy.element.style.top = enemy.y + "px";
                enemy.element.style.left = enemy.x + "px";

                if (isCollide(playerCar, enemy.element)) gameOver();
                if (player.y > enemy.y) passed++;
            });

            rankDisplay.innerText = 6 - passed;
            playerCar.style.left = player.x + "px";
            animationId = requestAnimationFrame(update);
        }

        function isCollide(a, b) {
            let aRect = a.getBoundingClientRect();
            let bRect = b.getBoundingClientRect();
            return !(aRect.bottom < bRect.top || aRect.top > bRect.bottom || aRect.right < bRect.left || aRect.left > bRect.right);
        }

        // --- CONTROLS ---
        const keys = {};
        let touchLeft = false, touchRight = false;

        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        // Touch Listeners
        document.getElementById('leftBtn').ontouchstart = () => touchLeft = true;
        document.getElementById('leftBtn').ontouchend = () => touchLeft = false;
        document.getElementById('rightBtn').ontouchstart = () => touchRight = true;
        document.getElementById('rightBtn').ontouchend = () => touchRight = false;
        document.getElementById('turboBtn').ontouchstart = () => player.turbo = true;
        document.getElementById('turboBtn').ontouchend = () => player.turbo = false;

        function handleInput() {
            if (!gameRunning) return;
            if ((keys.ArrowLeft || touchLeft) && player.x > 0) player.x -= player.speed;
            if ((keys.ArrowRight || touchRight) && player.x < (roadBox.width - 50)) player.x += player.speed;
            player.turbo = keys.ArrowUp || player.turbo; 
            setTimeout(handleInput, 16);
        }

        startBtn.onclick = () => {
            initPositions();
            setupRoad();
            createEnemies();
            score = 0;
            scoreDisplay.innerText = 0;
            gameRunning = true;
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            handleInput();
            update();
        };

        pauseBtn.onclick = () => {
            gameRunning = !gameRunning;
            pauseBtn.innerText = gameRunning ? "Pause" : "Resume";
            if (gameRunning) { update(); handleInput(); }
        };

        function gameOver() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            alert("Crash! Score: " + score);
            startBtn.disabled = false;
        }

        // Handle Resize
        window.addEventListener('resize', () => {
            roadBox = road.getBoundingClientRect();
        });
    </script>
</body>
</html>