<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Basantpur Turbo: Nepal Drift</title>
    <style>
        :root {
            --bhaktapur-red: #b32e2e;
            --patan-gold: #d4af37;
            --mountain-mist: #95a5a6;
            --window-blue: #74b9ff;
            --wooden-brown: #8B4513;
            --btn-size: clamp(65px, 18vw, 85px);
        }

        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; }

        body {
            background: #1a2634;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Orbitron', 'Segoe UI', sans-serif;
            color: #f0e9d8;
            overflow: hidden;
            touch-action: none;
        }

        /* --- DASHBOARD inspired by Nepali patka (cloth) --- */
        .dashboard {
            display: flex;
            width: 95vw;
            max-width: 400px;
            justify-content: space-between;
            background: linear-gradient(145deg, #3c2e1f, #1f1a12);
            padding: 12px 20px;
            border-radius: 30px 30px 15px 15px;
            margin-bottom: 15px;
            border: 2px solid var(--patan-gold);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
            backdrop-filter: blur(5px);
        }
        .stat { 
            font-size: 0.8rem; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            color: #e0d6b0;
        }
        .stat span { 
            display: block; 
            color: var(--patan-gold); 
            font-size: 1.2rem; 
            font-weight: bold; 
            text-shadow: 0 0 5px #f1c40f;
        }

        /* --- GAME WORLD: Basantpur Square vibe --- */
        .road {
            position: relative;
            width: 95vw;
            max-width: 400px;
            height: 55vh;
            background: #52412c;  /* old durbar square stone */
            border: 4px solid #6b4f32;
            border-radius: 0px 0px 20px 20px;
            overflow: hidden;
            box-shadow: inset 0 0 30px #2d1e0e, 0 10px 20px rgba(0,0,0,0.6);
            background-image: 
                linear-gradient(45deg, #6b4f32 2px, transparent 2px),
                linear-gradient(-45deg, #7e623b 1px, transparent 1px);
            background-size: 30px 30px, 40px 40px;
        }

        /* traditional window effect (newwari) */
        .road::before {
            content: "";
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(90deg, 
                transparent, 
                transparent 40px, 
                rgba(210, 180, 140, 0.1) 40px, 
                rgba(160, 120, 70, 0.2) 45px);
            pointer-events: none;
            z-index: 15;
        }

        /* road divider ‚Äì brick-like */
        .line { 
            width: 12px; 
            height: 45px; 
            background: #d4af37; 
            position: absolute; 
            left: 50%; 
            transform: translateX(-50%); 
            border-radius: 20%;
            box-shadow: 0 0 8px #f3d779, 0 0 15px #b8860b;
            border: 1px solid #a67c00;
            opacity: 0.8;
        }

        /* --- CARS : real nepali public vehicles --- */
        .car { 
            position: absolute; 
            width: 48px; 
            height: 85px; 
            border-radius: 15px 15px 8px 8px; 
            z-index: 20;
            transition: transform 0.1s;
            box-shadow: 0 8px 0 #222, 0 10px 15px rgba(0,0,0,0.3);
        }
        
        /* common microbus / tempo details */
        .car::before { /* windshield */
            content: ""; 
            position: absolute; 
            top: 12px; 
            left: 6px; 
            right: 6px; 
            height: 18px; 
            background: linear-gradient(145deg, #aaddff, #7fb5d0); 
            border-radius: 6px 6px 3px 3px;
            border: 1px solid #34495e;
        }
        .car::after { /* roof carrier (common in nepal) */
            content: "";
            position: absolute;
            top: -4px;
            left: 4px;
            right: 4px;
            height: 8px;
            background: #4a4a4a;
            border-radius: 8px 8px 0 0;
            border: 1px solid #2c3e50;
        }

        /* Player's car ‚Äì a decorated "Micro" with nepali flag colors */
        .player { 
            background: linear-gradient(145deg, #dc2626, #b91c1c); 
            border: 2px solid #f1c40f;
            box-shadow: 0 0 20px #e67e22, 0 8px 0 #7f1d1d;
        }
        .player::before { background: #f1c40f; border: 1px solid #b45309; } /* yellow windshield accent */
        
        /* enemy cars ‚Äì typical tempo / jeep */
        .enemy { 
            background: linear-gradient(145deg, #2d3e50, #1a2639); 
            border: 2px solid #f39c12;
            box-shadow: 0 5px 0 #111;
        }
        .enemy::before { background: #95a5a6; }

        /* --- SCREENS with wood carving texture --- */
        .overlay {
            position: absolute; inset: 0;
            background: rgba(30, 20, 8, 0.95);
            background-image: repeating-linear-gradient(45deg, #5f4c3b 1px, #3d2e1e 2px, #3d2e1e 10px);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 100; text-align: center;
            border: 6px double #d4af37;
            color: #ffefc0;
            font-family: 'Courier New', monospace;
        }
        .hidden { display: none !important; }

        /* --- CONTROLS styled like temple bells --- */
        .gamepad {
            margin-top: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            width: 95vw;
            max-width: 400px;
        }

        .btn {
            height: var(--btn-size);
            border-radius: 50% 50% 15px 15px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.1s;
            background: #brown;
            background: radial-gradient(circle at 30% 20%, #e0b479, #8b5a2b);
            border: 2px solid #d4af37;
            color: #1f1206;
            font-weight: bold;
            font-size: 1.8rem;
            box-shadow: 0 5px 0 #6b4f32, 0 8px 10px black;
        }

        .btn-move { border-bottom: 6px solid #4a3724; }
        .btn-move:active { transform: translateY(5px); box-shadow: 0 2px 0 #3d2e1e; background: #f3b33d; }
        
        .turbo-active { background: #f3b33d !important; border-color: #f1c40f; box-shadow: 0 0 25px gold; }

        .btn-sys { 
            font-size: 0.9rem; 
            text-transform: uppercase; 
            border-radius: 30px; 
            background: #5f4c3b; 
            color: #ecd5a3; 
            border: 2px solid #b98c5f;
        }
        
        .pulse { 
            animation: pulse 1.5s infinite; 
            background: #e67e22; 
            color: #2c1810; 
            border: 2px solid #f3b33d;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 #f39c12; }
            70% { transform: scale(1.05); box-shadow: 0 0 20px 10px rgba(243,156,18,0.3); }
            100% { transform: scale(1); }
        }

        /* small stupa-like decoration on road edges */
        .corner-temple {
            position: absolute; bottom: 0; left: 2px; width: 12px; height: 18px; background: #d4a373; z-index: 18; border-radius: 5px 5px 0 0; box-shadow: 0 0 0 2px #b5824e;
        }
    </style>
</head>
<body>

    <div class="dashboard">
        <div class="stat">üèîÔ∏è Highest <span id="highScore">0</span></div>
        <div class="stat">üìø Score <span id="score">0</span></div>
        <div class="stat">üöñ Rank <span id="rank">5/5</span></div>
    </div>

    <div class="road" id="road">
        <!-- subtle stupa at the bottom (fixed) -->
        <div class="corner-temple" style="left: 5px;"></div>
        <div class="corner-temple" style="right: 5px; left:auto;"></div>

        <div id="startScreen" class="overlay">
            <h1 style="color: #e6b422; margin:0; text-shadow: 2px 2px 0 #a5561b;">üö© BASANTPUR</h1>
            <p style="font-size: 1rem;">Dhulikhel ¬∑ Bhaktapur ¬∑ Drift</p>
            <button class="btn btn-sys pulse" style="width:160px; height:50px; margin-top:20px; font-size:1rem;" id="startBtn">START ENGINE</button>
        </div>

        <div id="gameOverScreen" class="overlay hidden">
            <h2 style="color:#e6b422">‚õ∞Ô∏è HILL CRASH</h2>
            <p>Score: <span id="finalScore">0</span></p>
            <button class="btn btn-sys pulse" style="width:160px; height:50px; margin-top:20px; font-size:1rem;" onclick="resetGame()">RESTART YATRA</button>
        </div>
    </div>

    <div class="gamepad">
        <div class="btn btn-move" id="leftBtn">‚¨ÖÔ∏è</div>
        <div class="btn btn-move" id="turboBtn">‚ö°</div>
        <div class="btn btn-move" id="rightBtn">‚û°Ô∏è</div>
        
        <div class="btn btn-sys" id="pauseBtn" style="grid-column: span 3; height: 40px; font-size:0.9rem;">‚è∏Ô∏è PAUSE</div>
    </div>

    <script>
        const road = document.getElementById('road');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('highScore');
        const rankDisplay = document.getElementById('rank');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScore = document.getElementById('finalScore');

        let gameRunning = false;
        let score = 0;
        let highScore = localStorage.getItem('basantpurHigh') || 0;
        highScoreDisplay.innerText = highScore;

        let roadBox = road.getBoundingClientRect();
        let player = { x: 0, y: 0, speed: 7, turbo: false, tilt: 0 };
        let enemies = [];
        let lines = [];
        const activeKeys = {};

        const playerCar = document.createElement('div');
        playerCar.classList.add('car', 'player');
        road.appendChild(playerCar);

        function init() {
            roadBox = road.getBoundingClientRect();
            player.x = (roadBox.width / 2) - 24;  // center car
            player.y = roadBox.height - 110;      // near bottom
            score = 0;
            updateStats();
            
            // remove old lines and enemies
            lines.forEach(l => l.remove());
            lines = [];
            // golden brick lines (nepali road divider)
            for(let i=0; i<8; i++) {
                let l = document.createElement('div');
                l.classList.add('line');
                l.y = i * 90 - 45;   // offset so first appears later
                road.appendChild(l);
                lines.push(l);
            }

            enemies.forEach(e => e.el.remove());
            enemies = [];
            // enemy vehicles (tempo / local bus)
            const colors = ['#3a5f7a', '#4a6a3b', '#b36b3a', '#7a4d4d', '#2c5f5f'];
            for(let i=0; i<4; i++) {
                let el = document.createElement('div');
                el.classList.add('car', 'enemy');
                el.style.backgroundColor = colors[i % colors.length];
                let obj = { el, x: Math.random()*(roadBox.width-50), y: (i*230)*-1 - 100, s: 2 + Math.random()*3 };
                road.appendChild(el);
                enemies.push(obj);
            }

            // make first enemy closer for immediate action
            if(enemies[0]) enemies[0].y = -120;
        }

        function gameLoop() {
            if (!gameRunning) return;

            // Move based on keys (left / right)
            let targetTilt = 0;
            if (activeKeys['leftBtn'] || activeKeys['ArrowLeft']) {
                if (player.x > 5) player.x -= player.speed;
                targetTilt = -8;
            }
            if (activeKeys['rightBtn'] || activeKeys['ArrowRight']) {
                if (player.x < (roadBox.width - 50)) player.x += player.speed;
                targetTilt = 8;
            }
            
            player.tilt += (targetTilt - player.tilt) * 0.15;
            player.turbo = !!(activeKeys['turboBtn'] || activeKeys['ArrowUp']);
            
            const worldSpeed = player.turbo ? 16 : 7; // turbo feels like downhill

            // move road lines (traditional bricks)
            lines.forEach(l => {
                l.y += worldSpeed;
                if (l.y > roadBox.height + 40) l.y = -60;
                l.style.top = l.y + "px";
            });

            // move enemies
            let passedCount = 0;
            enemies.forEach(en => {
                en.y += player.turbo ? en.s + 12 : en.s + 2; // base speed

                if (en.y > roadBox.height + 100) {
                    en.y = -200 - Math.random()*100;
                    en.x = 15 + Math.random() * (roadBox.width - 70);
                    score += 15;  // passed a vehicle
                    updateStats();
                }
                
                en.el.style.top = en.y + "px";
                en.el.style.left = en.x + "px";
                
                // collision detection (tight but fair)
                if (isCollide(playerCar, en.el, 8)) endGame();

                // count vehicles we are ahead of (for rank)
                if (player.y < en.y + 20) passedCount++;
            });

            // Rank: out of 5 vehicles (4 enemies + imaginary one)
            let rankValue = Math.min(5, passedCount);
            rankDisplay.innerText = `${5 - rankValue}/5`;

            playerCar.style.left = player.x + "px";
            playerCar.style.top = player.y + "px";
            playerCar.style.transform = `rotate(${player.tilt}deg)`;

            requestAnimationFrame(gameLoop);
        }

        function isCollide(a, b, buffer = 5) {
            let r1 = a.getBoundingClientRect();
            let r2 = b.getBoundingClientRect();
            return !(
                r1.bottom - buffer < r2.top || 
                r1.top + buffer > r2.bottom || 
                r1.right - buffer < r2.left || 
                r1.left + buffer > r2.right
            );
        }

        function updateStats() {
            scoreDisplay.innerText = score;
            if (score > highScore) {
                highScore = score;
                highScoreDisplay.innerText = highScore;
                localStorage.setItem('basantpurHigh', highScore);
            }
        }

        // --- INPUT BINDINGS for nepali gamepad ---
        function setupInput(id) {
            const el = document.getElementById(id);
            const press = (e) => { 
                e.preventDefault(); 
                activeKeys[id] = true; 
                if(id === 'turboBtn') el.classList.add('turbo-active');
            };
            const release = () => { 
                activeKeys[id] = false; 
                if(id === 'turboBtn') el.classList.remove('turbo-active');
            };
            el.addEventListener('touchstart', press);
            el.addEventListener('touchend', release);
            el.addEventListener('mousedown', press);
            el.addEventListener('mouseup', release);
            el.addEventListener('mouseleave', release);
        }
        ['leftBtn', 'rightBtn', 'turboBtn'].forEach(setupInput);

        window.onkeydown = (e) => { 
            if(['ArrowLeft','ArrowRight','ArrowUp'].includes(e.key)) {
                e.preventDefault(); 
                activeKeys[e.key] = true; 
            }
        };
        window.onkeyup = (e) => {
            if(['ArrowLeft','ArrowRight','ArrowUp'].includes(e.key)) {
                activeKeys[e.key] = false; 
            }
        };

        document.getElementById('startBtn').onclick = () => {
            startScreen.classList.add('hidden');
            gameRunning = true;
            init();
            gameLoop();
        };

        function endGame() {
            if (!gameRunning) return;
            gameRunning = false;
            finalScore.innerText = score;
            gameOverScreen.classList.remove('hidden');
        }

        window.resetGame = function() {
            gameOverScreen.classList.add('hidden');
            init();
            gameRunning = true;
            gameLoop();
        };

        document.getElementById('pauseBtn').onclick = function() {
            if(gameRunning) {
                gameRunning = false;
                this.innerText = '‚ñ∂Ô∏è RESUME';
            } else {
                if(!startScreen.classList.contains('hidden')) return;
                gameRunning = true;
                this.innerText = '‚è∏Ô∏è PAUSE';
                gameLoop();
            }
        };

        // update road box on resize (mobile orientation)
        window.onresize = () => {
            roadBox = road.getBoundingClientRect();
            // reposition player within new bounds
            if (player.x + 50 > roadBox.width) player.x = roadBox.width - 55;
            if (player.x < 5) player.x = 5;
        };
    </script>
</body>
</html>
